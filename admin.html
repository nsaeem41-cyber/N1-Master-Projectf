<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N One Control | Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</title>
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --success: #27ae60; --danger: #e74c3c; --bg: #f0f2f5; --white: #ffffff; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: var(--white); padding: 35px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); width: 95%; max-width: 850px; border-top: 8px solid var(--primary); }
        .hidden { display: none !important; }
        h1, h2 { color: var(--primary); text-align: center; margin-bottom: 25px; font-weight: 800; }
        input, select { width: 100%; padding: 14px; margin: 10px 0; border: 1px solid #e1e4e8; border-radius: 12px; box-sizing: border-box; text-align: right; font-size: 15px; transition: 0.3s; }
        input:focus { border-color: var(--accent); outline: none; box-shadow: 0 0 8px rgba(52, 152, 219, 0.2); }
        button { padding: 14px 20px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; transition: 0.3s; width: 100%; font-size: 16px; }
        .btn-login { background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3); }
        .btn-save { background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; margin-top: 15px; }
        .btn-logout { background: #95a5a6; color: white; width: auto; float: left; margin-bottom: 20px; padding: 8px 18px; font-size: 13px; }
        table { width: 100%; border-collapse: collapse; margin-top: 25px; border-radius: 12px; overflow: hidden; }
        th, td { border: 1px solid #f0f2f5; padding: 15px; text-align: center; }
        th { background: #f8f9fa; color: var(--primary); font-weight: 700; }
        tr:hover { background: #fcfcfc; }
        .form-box { background: #fdfdfd; padding: 25px; border-radius: 15px; border: 1px solid #edf0f2; margin-bottom: 30px; }
    </style>
</head>
<body>
    <div id="loginSection" class="container" style="max-width: 420px;">
        <h1>N One Portal</h1>
        <input type="text" id="userInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <input type="password" id="passInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn-login" onclick="validateLogin()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
    </div>

    <div id="adminPanel" class="container hidden">
        <button class="btn-logout" onclick="logout()">Ø®Ø±ÙˆØ¬ Ø¢Ù…Ù†</button>
        <div style="clear: both;"></div>
        <h2>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø´Ø¢Øª</h2>
        <div class="form-box">
            <input type="text" id="compName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© / Ø§Ù„Ù…Ù†Ø´Ø£Ø©">
            <input type="text" id="compUser" placeholder="ÙŠÙˆØ²Ø± Ù†ÙŠÙ… Ø§Ù„Ø´Ø±ÙƒØ©">
            <input type="password" id="compPass" placeholder="Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø´Ø±ÙƒØ©">
            <select id="compPlan">
                <option value="0">Ø§Ø®ØªØ± Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</option>
                <option value="30">Ø¨Ø§Ù‚Ø© 30 ÙŠÙˆÙ…</option>
                <option value="90">Ø¨Ø§Ù‚Ø© 3 Ø´Ù‡Ø±</option>
                <option value="365">Ø¨Ø§Ù‚Ø© Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø©</option>
            </select>
            <button class="btn-save" onclick="saveCompany()">ØªÙØ¹ÙŠÙ„ ÙˆØ­ÙØ¸ Ø³Ø­Ø§Ø¨ÙŠ</button>
        </div>
        <table>
            <thead><tr><th>Ø§Ù„Ù…Ù†Ø´Ø£Ø©</th><th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
            <tbody id="companyTableBody"></tbody>
        </table>
    </div>

    <script>
        const API_URL = 'https://sheetdb.io/api/v1/qzfkwfzcpbrsm';
        let companies = JSON.parse(localStorage.getItem('n1_companies')) || [];

        async function sync() {
            try {
                const r = await fetch(API_URL);
                const d = await r.json();
                if(d.length > 0) {
                    companies = d.filter(i => i.user && i.pass);
                    localStorage.setItem('n1_companies', JSON.stringify(companies));
                    if(!document.getElementById('adminPanel').classList.contains('hidden')) renderTable();
                }
            } catch(e) { console.log("Sync Error"); }
        }
        window.onload = sync;

        function validateLogin() {
            const u = document.getElementById('userInput').value, p = document.getElementById('passInput').value;
            if (u === "admin" && p === "n1_2026") { renderTable(); showPanel('adminPanel'); return; }
            const f = companies.find(c => c.user === u && c.pass === p);
            if (f) {
                if(new Date() > new Date(f.expiry)) return alert("Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ù†ØªÙ‡ÙŠ");
                sessionStorage.setItem('currentActiveCompanyName', f.name);
                sessionStorage.setItem('currentActiveUser', f.user);
                window.location.href = "company_dashboard.html";
            } else { alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©"); }
        }

        async function saveCompany() {
            const n = document.getElementById('compName').value, u = document.getElementById('compUser').value, p = document.getElementById('compPass').value, d = parseInt(document.getElementById('compPlan').value);
            if(!n || !u || !p || d === 0) return alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            let ex = new Date(); ex.setDate(ex.getDate() + d);
            const data = { id: Date.now(), name: n, user: u, pass: p, expiry: ex.toISOString() };
            try {
                await fetch(API_URL, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({data: [data]}) });
                companies.push(data); localStorage.setItem('n1_companies', JSON.stringify(companies));
                alert("ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ ÙˆØ§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­ ğŸ˜Š"); renderTable();
            } catch(e) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©"); }
        }

        function renderTable() {
            const b = document.getElementById('companyTableBody'); b.innerHTML = "";
            companies.forEach(c => {
                b.innerHTML += `<tr><td>${c.name}</td><td>${c.user}</td><td>${new Date(c.expiry).toLocaleDateString()}</td><td><button onclick="deleteComp(${c.id})" style="background:#e74c3c; color:white; width:auto; padding:6px 12px; font-size:12px; border-radius:8px;">Ø­Ø°Ù</button></td></tr>`;
            });
        }
        function deleteComp(id) { if(confirm("Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ")) { companies = companies.filter(c => c.id !== id); localStorage.setItem('n1_companies', JSON.stringify(companies)); renderTable(); } }
        function showPanel(id) { document.getElementById('loginSection').classList.add('hidden'); document.getElementById(id).classList.remove('hidden'); }
        function logout() { sessionStorage.clear(); location.reload(); }
    </script>
</body>
</html>
