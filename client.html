<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N One | ØºØ±ÙØ© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ================= ØªØµÙ…ÙŠÙ… Ultimate Command Center ================= */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #eef2f5; margin: 0; padding: 0;
            user-select: none; height: 100vh; overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* 1. Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ (Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª) */
        .top-bar {
            background: #1a237e; color: white; padding: 0 20px;
            display: flex; justify-content: space-between; align-items: center;
            height: 60px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 1000;
        }
        .brand { font-size: 18px; font-weight: 900; }
        .gold { color: #d4af37; }
        
        .finance-controls { display: flex; gap: 10px; align-items: center; font-size: 13px; }
        .finance-input {
            width: 50px; padding: 5px; border-radius: 5px; border: none;
            text-align: center; font-weight: bold; color: #1a237e;
        }
        .btn-reset {
            background: #c62828; color: white; border: none; padding: 5px 10px;
            border-radius: 5px; cursor: pointer; font-size: 11px;
        }

        /* 2. ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø´Ø§Ø´Ø© (ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨) */
        .main-layout {
            display: flex; flex: 1; height: calc(100vh - 60px);
        }

        /* Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠÙ…Ù†: Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© (Live Feed) */
        .right-panel-feed {
            width: 55%; background: #f4f7f6; padding: 20px;
            overflow-y: auto; display: flex; flex-direction: column;
            border-left: 2px solid #ddd;
        }

        /* Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø±: Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ */
        .left-panel-form {
            width: 45%; background: white; padding: 20px;
            overflow-y: auto; box-shadow: 5px 0 15px rgba(0,0,0,0.05);
        }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .card-title {
            font-size: 18px; font-weight: bold; color: #1a237e;
            border-bottom: 2px solid #d4af37; padding-bottom: 10px; margin-bottom: 15px;
            display: flex; justify-content: space-between;
        }
        .manual-tag {
            background: #e3f2fd; color: #1565c0; padding: 2px 8px; 
            border-radius: 4px; font-size: 12px; border: 1px solid #1565c0;
        }

        .input-group { margin-bottom: 12px; }
        label { display: block; font-size: 12px; font-weight: bold; color: #555; margin-bottom: 5px; }
        input, select {
            width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px;
            font-size: 14px; background: #fafafa; outline: none; box-sizing: border-box;
        }
        input:focus { border-color: #1a237e; background: white; }

        .btn-send {
            width: 100%; padding: 15px; background: #1a237e; color: white;
            border: none; border-radius: 12px; font-size: 16px; font-weight: bold;
            cursor: pointer; margin-top: 10px; transition: 0.2s;
        }
        .btn-send:hover { background: #0d155a; transform: scale(1.02); }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø³Ø¬Ù„ (Ø§Ù„ÙŠÙ…ÙŠÙ†) - Ù†Ø¨Ø¶ Ø§Ù„Ù‚Ù„Ø¨ */
        .log-card {
            background: white; padding: 15px; border-radius: 10px;
            margin-bottom: 10px; border-right: 4px solid #1a237e;
            display: flex; justify-content: space-between; align-items: center;
            animation: pulseFade 0.5s ease-in; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        @keyframes pulseFade { 
            0% { opacity: 0; transform: scale(0.95); } 
            50% { transform: scale(1.02); }
            100% { opacity: 1; transform: scale(1); } 
        }
        
        .log-info { font-size: 13px; color: #333; }
        .log-finance { font-size: 12px; color: #2e7d32; font-weight: bold; }
        .log-time { font-size: 11px; color: #888; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© (Finance Dashboard) */
        .finance-dashboard {
            background: #fff3e0; padding: 15px; border-radius: 10px;
            margin-bottom: 20px; border: 1px solid #ffe0b2;
        }
        .finance-item {
            display: flex; justify-content: space-between; border-bottom: 1px solid #eee;
            padding: 5px 0; font-size: 13px;
        }

        /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆØ¯ (Ø§Ù„Ù…ÙŠØ«Ø§Ù‚) */
        .legacy-hidden { display: none; }

        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 5000; display: flex;
            justify-content: center; align-items: center; flex-direction: column;
        }
    </style>
</head>
<body>

    <div id="loader">
        <h2 style="color:#1a237e;">N <span style="color:#d4af37">One</span></h2>
        <p>Ø¬Ø§Ø±ÙŠ Ø¶Ø¨Ø· Ø§Ù„Ø£Ù‚Ù…Ø§Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©... ğŸ˜ŠğŸš€</p>
    </div>

    <div class="top-bar">
        <div class="brand">N <span class="gold">One</span> Admin</div>
        <div class="finance-controls">
            <span>Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙƒØ© (%):</span>
            <input type="number" id="company_percentage" class="finance-input" value="10" onchange="saveSettings()">
            <button class="btn-reset" onclick="resetFinanceWeek()">ğŸ”„ ØªØµÙÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ</button>
            <button onclick="logout()" style="background:none; border:none; color:white; cursor:pointer;">ğŸ”’ Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>

    <div class="main-layout">
        
        <div class="right-panel-feed">
            <div class="finance-dashboard">
                <h4 style="margin:0 0 10px 0; color:#e65100;">ğŸ’° Ø³Ø¬Ù„ Ù…Ø³ØªØ­Ù‚Ø§Øª Ø§Ù„ÙƒØ¨Ø§ØªÙ† (Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø§Ù„ÙŠ)</h4>
                <div id="finance-list">
                    <div style="text-align:center; color:#777;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©...</div>
                </div>
            </div>

            <h4 style="margin:0 0 10px 0; color:#555;">ğŸ“¡ Ù…Ø±ÙƒØ² Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Live Feed)</h4>
            <div id="live-feed">
                </div>
        </div>

        <div class="left-panel-form">
            <div class="card-title">
                <span>ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</span>
                <span class="manual-tag">ÙŠØ¯ÙˆÙŠ</span>
            </div>

            <div class="input-group">
                <label>ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ø¨ØªÙ†</label>
                <input type="text" id="manual_cap_name" placeholder="Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯...">
            </div>

            <div class="input-group">
                <label>ğŸ“± Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„ÙƒØ§Ø¨ØªÙ†</label>
                <input type="tel" id="manual_cap_phone" placeholder="079...">
            </div>

            <div class="input-group">
                <label>ğŸ“ Ø§Ù„Ù…ØµØ¯Ø± / Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù… (Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)</label>
                <input type="text" id="pickup_name" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø·Ø¹Ù… Ø§Ù„Ø´Ø§ÙˆØ±Ù…Ø§ - Ø§Ù„Ø¯ÙˆØ§Ø± Ø§Ù„Ø³Ø§Ø¨Ø¹">
            </div>

            <div class="input-group">
                <label>ğŸ’° Ù‚ÙŠÙ…Ø© Ø§Ù„Ø´Ø­Ù†Ø© (Ø§Ù„Ø·Ù„Ø¨)</label>
                <input type="number" id="order_val" placeholder="0.00">
            </div>

            <div class="input-group">
                <label>ğŸ›µ Ø£Ø¬Ø±Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ (Ø§Ù„ØªÙˆØµÙŠÙ„)</label>
                <input type="number" id="delivery_fee" placeholder="0.00">
            </div>

            <button class="btn-send" onclick="sendOrder()">Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨ + ØªÙˆØ«ÙŠÙ‚ ğŸš€</button>

            <div class="legacy-hidden">
                <select id="captain_select"></select>
                <input type="text" id="pickup_loc_link">
                <input type="text" id="cust_name" value="General">
                <input type="text" id="cust_phone" value="000">
            </div>
        </div>
    </div>

    <audio id="alert-sound" src="data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU"></audio>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycby8Lvhri3wDGXFwXY2EPKy_sf6vrIEAyPVGreob8gDe_mx9EbpqWsqqR511LXdqjjU1/exec";
        
        let currentUser = null;
        let myData = []; 
        let orders = [];
        // Ø³Ø¬Ù„ Ù…Ø§Ù„ÙŠ Ù…Ø­Ù„ÙŠ Ù„Ù„ÙƒØ¨Ø§ØªÙ† (Ø§Ù„Ø§Ø³Ù…: {Ø¹Ø¯Ø¯_Ø§Ù„Ø·Ù„Ø¨Ø§Øª, Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª})
        let capStats = JSON.parse(localStorage.getItem('nOne_cap_stats')) || {};

        window.onload = async function() {
            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
            if(localStorage.getItem('nOne_percent')) {
                document.getElementById('company_percentage').value = localStorage.getItem('nOne_percent');
            }

            currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) { window.location.replace('index.html'); return; }

            await refreshData();
            document.getElementById('loader').style.display = 'none';
            setInterval(checkMyStatus, 10000); 
            updateFinanceDisplay();
        };

        async function refreshData() {
            try {
                const res = await fetch(API_URL + "?action=read");
                const all = await res.json();
                myData = all.filter(item => (item.cl || item.client_user) === currentUser.user);
                orders = myData.filter(i => i.type === 'order');
                updateLiveFeed();
            } catch (e) { console.error(e); }
        }

        function updateLiveFeed() {
            const feed = document.getElementById('live-feed');
            feed.innerHTML = orders.slice().reverse().map(o => `
                <div class="log-card">
                    <div>
                        <div style="font-weight:bold; color:#1a237e;">${o.cap_name}</div>
                        <div class="log-info">${o.pickup.includes('http') ? 'Ù…ÙˆÙ‚Ø¹ Ù…Ø³Ø¬Ù„' : o.pickup} | ${o.val} Ø¯.Ø£</div>
                    </div>
                    <div style="text-align:left;">
                        <div class="log-finance">Ø£Ø¬Ø±Ø©: ${o.fee}</div>
                        <div class="log-time">${o.date.split('T')[1].substring(0,5)}</div>
                    </div>
                </div>
            `).join('');
        }

        async function sendOrder() {
            // 1. Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠØ¯ÙˆÙŠØ©
            const capName = document.getElementById('manual_cap_name').value;
            const capPhone = document.getElementById('manual_cap_phone').value;
            const shopName = document.getElementById('pickup_name').value;
            const val = document.getElementById('order_val').value;
            const fee = document.getElementById('delivery_fee').value;
            
            if(!capName || !shopName || !val || !fee) return alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ© ÙŠØ§ Ø­Ø¨Ø© Ø§Ù„Ø³ÙƒØ± ğŸ˜Š");

            // 2. Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Smart Link Generation)
            // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø¨Ø­Ø« Ø°ÙƒÙŠ ÙÙŠ Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¹Ø§Ù…
            const mapLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(shopName)}`;
            document.getElementById('pickup_loc_link').value = mapLink; 

            // 3. Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© (Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙƒØ©)
            const percent = document.getElementById('company_percentage').value;
            const companyShare = (fee * (percent / 100)).toFixed(2);
            
            // ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„ÙƒØ§Ø¨ØªÙ† Ø§Ù„ÙŠÙˆÙ…ÙŠ
            if (!capStats[capName]) capStats[capName] = { count: 0, total_dues: 0 };
            capStats[capName].count += 1;
            
            // Ø­Ø³Ø§Ø¨ "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª" (Ø§Ù„Ø£Ø¬Ø±Ø© + Ù‚ÙŠÙ…Ø© Ø§Ù„Ø´Ø­Ù†Ø©) Ù„ØºØ§ÙŠØ§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù„ÙƒØ§Ø¨ØªÙ†
            // Ù…Ù„Ø§Ø­Ø¸Ø©: "Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª" Ù‡Ù†Ø§ ØªØ¹Ù†ÙŠ Ù…Ø§ Ù„Ù„ÙƒØ§Ø¨ØªÙ† (Ø§Ù„Ø£Ø¬Ø±Ø©) ÙˆÙ…Ø§ Ø¹Ù„ÙŠÙ‡ (Ø§Ù„Ø·Ù„Ø¨) Ù„ÙŠØ³Ø¯Ø¯Ù‡
            const dailyTotal = (parseFloat(capStats[capName].total_dues) + parseFloat(fee) + parseFloat(val)).toFixed(2);
            capStats[capName].total_dues = dailyTotal; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ
            
            localStorage.setItem('nOne_cap_stats', JSON.stringify(capStats));
            updateFinanceDisplay();

            // 4. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø³ÙŠØ±ÙØ±
            const newOrder = {
                id: "ORD_" + Date.now(),
                type: "order",
                client_user: currentUser.user,
                cl_name: currentUser.name,
                cap_name: capName,
                cap_phone: capPhone,
                pickup: mapLink, // Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°ÙƒÙŠ
                val: val,
                fee: fee,
                company_share: companyShare, // Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ù‚ØªØ·Ø¹Ø©
                cust_name: "General",
                cust_phone: "000",
                date: new Date().toISOString(),
                status: "new"
            };

            // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
            playAlert();

            await sendData(newOrder);

            // 5. ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ø·ÙˆØ± (Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©)
            let p = capPhone.replace(/\D/g, '');
            if (!p.startsWith('962')) p = '962' + p.replace(/^0+/, '');
            
            const msg = `Ø¥Ø´Ø¹Ø§Ø± Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ - N One%0a` +
                        `ğŸ‘¤ *Ø§Ù„Ù…Ø±Ø³Ù„ Ø¥Ù„ÙŠÙ‡:* ${capName}%0a` +
                        `ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ:%0a` +
                        `ğŸ  *Ø§Ù„Ù…ØµØ¯Ø±:* ${shopName}%0a` +
                        `ğŸ“ *Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ:* ${mapLink}%0a` +
                        `--------------------------------%0a` +
                        `ğŸ’µ *Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„:*%0a` +
                        `ğŸ”¸ *Ø£Ø¬Ø±Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨:* ${fee} Ø¯.Ø£%0a` +
                        `ğŸ”¸ *Ù‚ÙŠÙ…Ø© Ø§Ù„Ø´Ø­Ù†Ø©:* ${val} Ø¯.Ø£%0a` +
                        `--------------------------------%0a` +
                        `ğŸ“Š *Ù…Ù„Ø®Øµ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙŠÙˆÙ…ÙŠ:*%0a` +
                        `ğŸ“¦ *Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:* (${capStats[capName].count})%0a` +
                        `ğŸ’° *Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª:* ${dailyTotal} Ø¯.Ø£%0a` +
                        `--------------------------------%0a` +
                        `ğŸ›‘ *Ù†Ø±Ø¬Ùˆ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨ØªØ¹Ø§Ù„ÙŠÙ… Ø§Ù„Ø´Ø±ÙƒØ©*%0a` +
                        `ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… ğŸš€`;
            
            window.open(`https://wa.me/${p}?text=${msg}`, '_blank');
            
            alert("ØªÙ… Ø§Ù„ØªÙˆØ«ÙŠÙ‚ ÙˆØ§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ…");
            refreshData();
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ
        function updateFinanceDisplay() {
            const list = document.getElementById('finance-list');
            let html = '';
            for (let [cap, data] of Object.entries(capStats)) {
                html += `
                    <div class="finance-item">
                        <span>${cap} (${data.count})</span>
                        <span style="font-weight:bold; color:#d4af37;">${data.total_dues} Ø¯.Ø£</span>
                    </div>
                `;
            }
            if(html === '') html = '<div style="text-align:center; color:#777;">Ø³Ø¬Ù„ Ù†Ø¸ÙŠÙ</div>';
            list.innerHTML = html;
        }

        function saveSettings() {
            const p = document.getElementById('company_percentage').value;
            localStorage.setItem('nOne_percent', p);
        }

        function resetFinanceWeek() {
            if(!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ø³Ø­ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù„Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠØŸ")) return;
            capStats = {};
            localStorage.removeItem('nOne_cap_stats');
            updateFinanceDisplay();
            alert("ØªÙ… Ø¨Ø¯Ø¡ Ø¯ÙˆØ±Ø© Ù…Ø§Ù„ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© ğŸ”„");
        }

        function playAlert() {
            const audio = document.getElementById('alert-sound');
            if(audio) audio.play().catch(e => console.log("Audio requires interaction"));
        }

        async function sendData(dataObj) {
            await fetch(API_URL, {
                method: 'POST', mode: 'no-cors',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ action: 'add', data: dataObj })
            });
            await new Promise(r => setTimeout(r, 1000));
        }

        async function checkMyStatus() {
            try {
                const res = await fetch(API_URL + "?action=read");
                const all = await res.json();
                const me = all.find(u => u.user === currentUser.user);
                if (!me || me.status !== 'active') { alert("Ù…ÙˆÙ‚ÙˆÙ"); logout(); }
            } catch(e) {}
        }

        function logout() {
            localStorage.removeItem('currentUser');
            sessionStorage.clear();
            window.location.replace('index.html');
        }
        
        // Ø¯ÙˆØ§Ù„ ÙˆÙ‡Ù…ÙŠØ© Ù„Ù„Ù…ÙŠØ«Ø§Ù‚
        function getMyGPS() {}
        function fillCaptainData() {}
    </script>
</body>
</html>
