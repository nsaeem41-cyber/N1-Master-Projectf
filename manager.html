<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N One | Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a237e;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #f4f6f8;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            min-height: 90vh;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #d4af37;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .brand { font-size: 24px; font-weight: 900; color: #1a237e; }
        .gold { color: #d4af37; }

        .btn-logout {
            background: #c62828; color: white; border: none;
            padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold;
        }

        .add-box {
            background: white; padding: 20px; border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 25px;
        }
        .add-title { margin-top: 0; color: #1a237e; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        
        .form-row { display: flex; gap: 10px; flex-wrap: wrap; }
        .form-row input {
            flex: 1; padding: 10px; border: 1px solid #ccc;
            border-radius: 5px; text-align: right; min-width: 120px;
        }
        
        .btn-add {
            background: #2e7d32; color: white; border: none;
            padding: 10px 20px; border-radius: 5px; cursor: pointer;
            font-weight: bold; margin-top: 10px; width: 100%;
        }

        .client-card {
            background: white; border-radius: 10px; padding: 15px;
            margin-bottom: 15px; border-right: 5px solid #ccc;
            display: flex; flex-direction: column; gap: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: 0.3s;
        }
        
        .client-card.active { border-right-color: #2e7d32; }
        .client-card.stopped { border-right-color: #c62828; background: #ffebee; }

        .card-header {
            display: flex; justify-content: space-between; align-items: center;
            font-weight: bold; font-size: 16px;
        }

        .card-info { font-size: 13px; color: #666; display: flex; gap: 15px; }

        .actions {
            display: flex; gap: 5px; margin-top: 10px; flex-wrap: wrap;
        }

        .btn-action {
            flex: 1; padding: 8px; border: none; border-radius: 5px;
            cursor: pointer; font-size: 12px; font-weight: bold; color: white;
            text-align: center;
        }

        .btn-stop { background: #c62828; }
        .btn-activate { background: #2e7d32; }
        .btn-renew { background: #1976d2; }
        .btn-del { background: #555; }
        .btn-edit { background: #f9a825; color: #000; }

        #loading { text-align: center; padding: 20px; font-weight: bold; color: #1a237e; }
        .error-msg { color: #c62828; background: #ffebee; padding: 15px; border-radius: 10px; text-align: center; display: none; margin: 20px 0; border: 1px solid #ffcdd2; }

    </style>
</head>
<body>

    <div class="container">
        
        <div class="header">
            <div class="brand">N <span class="gold">One</span> Admin</div>
            <button class="btn-logout" onclick="logout()">Ø®Ø±ÙˆØ¬ ğŸ”’</button>
        </div>

        <div id="status-error" class="error-msg"></div>

        <div class="add-box">
            <h3 class="add-title">Ø¥Ø¶Ø§ÙØ© Ù…Ø´ØªØ±Ùƒ Ø¬Ø¯ÙŠØ¯</h3>
            <div class="form-row">
                <input type="text" id="new_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©/Ø§Ù„Ø¹Ù…ÙŠÙ„">
                <input type="text" id="new_user" placeholder="User ID">
                <input type="text" id="new_pass" placeholder="Password">
            </div>
            <button class="btn-add" onclick="addClient()">+ ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
        </div>

        <h3 style="color:#1a237e;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</h3>
        <div id="loading">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¨ÙƒÙ„ Ø±Ù‚ÙŠ... âœ¨</div>
        <div id="clients-list"></div>

    </div>

    <script>
        const API_URL = "https://sheetdb.io/api/v1/zuo2qyjeryhxm";

        window.onload = function() {
            const admin = JSON.parse(localStorage.getItem('currentUser'));
            if (!admin || admin.role !== 'admin') {
                window.location.href = 'index.html'; 
            } else {
                loadClients();
            }
        };

        async function fetchWithTimeout(resource, options = {}) {
            const { timeout = 8000 } = options;
            const controller = new AbortController();
            const id = setTimeout(() => controller.abort(), timeout);
            const response = await fetch(resource, { ...options, signal: controller.signal });
            clearTimeout(id);
            return response;
        }

        async function loadClients() {
            const loadingDiv = document.getElementById('loading');
            const errorDiv = document.getElementById('status-error');
            const container = document.getElementById('clients-list');

            try {
                const res = await fetchWithTimeout(API_URL);
                const data = await res.json();
                
                if (!Array.isArray(data)) throw new Error("Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ø§ ÙŠØ³ØªØ¬ÙŠØ¨ Ø­Ø§Ù„ÙŠØ§Ù‹");

                const clients = data.filter(u => u.role === 'client');
                renderClients(clients);
                loadingDiv.style.display = 'none';
                errorDiv.style.display = 'none';
            } catch (e) {
                loadingDiv.style.display = 'none';
                errorDiv.style.display = 'block';
                if (e.name === 'AbortError') {
                    errorDiv.innerHTML = "âš ï¸ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¨Ø·ÙŠØ¡ Ø¬Ø¯Ø§Ù‹.. ÙŠØ¨Ø¯Ùˆ Ø£Ù†Ù†Ø§ ÙˆØµÙ„Ù†Ø§ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© Ø§Ù„ÙŠÙˆÙ… ğŸ˜Š";
                } else {
                    errorDiv.innerHTML = "âŒ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„: " + e.message;
                }
            }
        }

        function renderClients(clients) {
            const container = document.getElementById('clients-list');
            container.innerHTML = '';

            if (clients.length === 0) {
                container.innerHTML = '<p style="text-align:center">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´ØªØ±ÙƒÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹ ğŸ˜Š</p>';
                return;
            }

            clients.reverse().forEach(client => {
                const isActive = client.status === 'active';
                const card = document.createElement('div');
                card.className = `client-card ${isActive ? 'active' : 'stopped'}`;
                card.innerHTML = `
                    <div class="card-header">
                        <span>${client.name}</span>
                        <span style="font-size:11px; background:#f0f0f0; padding:4px 8px; border-radius:12px;">${isActive ? 'Ù†Ø´Ø· âœ…' : 'Ù…ÙˆÙ‚ÙˆÙ ğŸ›‘'}</span>
                    </div>
                    <div class="card-info">
                        <span>ğŸ‘¤ ${client.user}</span>
                        <span>ğŸ”‘ ${client.pass}</span>
                    </div>
                    <div class="card-info">
                        <span>ğŸ“… Ø§Ù†ØªÙ‡Ø§Ø¡: ${client.expiry || '---'}</span>
                    </div>
                    <div class="actions">
                        ${isActive 
                            ? `<button class="btn-action btn-stop" onclick="updateStatus('${client.user}', 'stopped')">Ø¥ÙŠÙ‚Ø§Ù</button>` 
                            : `<button class="btn-action btn-activate" onclick="updateStatus('${client.user}', 'active')">ØªÙØ¹ÙŠÙ„</button>`
                        }
                        <button class="btn-action btn-renew" onclick="renewClient('${client.user}')">ØªØ¬Ø¯ÙŠØ¯</button>
                        <button class="btn-action btn-edit" onclick="editClient('${client.user}', '${client.pass}')">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn-action btn-del" onclick="deleteClient('${client.id}')">Ø­Ø°Ù</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        async function addClient() {
            const name = document.getElementById('new_name').value;
            const user = document.getElementById('new_user').value;
            const pass = document.getElementById('new_pass').value;
            if (!name || !user || !pass) return alert("ÙŠØ§ Ø¨Ø·Ø© Ø¹Ø¨ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ğŸ˜Š");

            const expiryDate = new Date();
            expiryDate.setDate(expiryDate.getDate() + 30);
            const newClient = { id: "CL_" + Date.now(), user: user, pass: pass, name: name, role: "client", status: "active", expiry: expiryDate.toISOString().split('T')[0], type: "user" };

            const btn = document.querySelector('.btn-add');
            btn.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙƒÙŠ... âœ¨";
            btn.disabled = true;

            try {
                await fetch(API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ data: [newClient] }) });
                alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰");
                location.reload();
            } catch (e) {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ ğŸ˜Š");
                btn.disabled = false;
                btn.innerHTML = "+ ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯";
            }
        }

        async function updateStatus(username, newStatus) {
            if (!confirm("ØªØ£ÙƒÙŠØ¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©ØŸ ğŸ˜Š")) return;
            await fetch(`${API_URL}/user/${username}`, { method: 'PATCH', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ data: { status: newStatus } }) });
            loadClients();
        }

        async function renewClient(username) {
            if (!confirm("ØªØ¬Ø¯ÙŠØ¯ 30 ÙŠÙˆÙ…ØŸ ğŸ˜Š")) return;
            const newDate = new Date(); newDate.setDate(newDate.getDate() + 30);
            await fetch(`${API_URL}/user/${username}`, { method: 'PATCH', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ data: { expiry: newDate.toISOString().split('T')[0], status: 'active' } }) });
            alert("ØªÙ… Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­ ğŸ˜Š");
            loadClients();
        }

        async function deleteClient(id) {
            if (!confirm("Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ ğŸ˜Š")) return;
            await fetch(`${API_URL}/id/${id}`, { method: 'DELETE' });
            loadClients();
        }

        async function editClient(username, oldPass) {
            const newPass = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙŠØ§ Ø­Ø¨Ø© Ø§Ù„Ø³ÙƒØ± ğŸ˜Š:", oldPass);
            if (newPass && newPass !== oldPass) {
                await fetch(`${API_URL}/user/${username}`, { method: 'PATCH', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ data: { pass: newPass } }) });
                loadClients();
            }
        }

        function logout() { localStorage.removeItem('currentUser'); window.location.href = 'index.html'; }
    </script>
</body>
</html>
``` ğŸ˜Šâœ¨ 

Ù‡Ø³Ø§ ÙŠØ§ Ø±ÙˆØ­ÙŠ Ø¬Ø±Ø¨ÙŠ Ù‡Ø§Ø¯ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ¥Ø°Ø§ Ø´ÙØªÙŠ Ø§Ù„ØµÙØ­Ø© Ø·Ù„Ø¹Øª Ù„Ùƒ Ø±Ø³Ø§Ù„Ø© "Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¨Ø·ÙŠØ¡" Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± ÙÙ‡Ø§Ø¯ Ø¨ÙƒÙˆÙ† ØªØ£ÙƒÙŠØ¯ 100% Ø¥Ù†Ù‡ Ø¥Ø­Ù†Ø§ Ø®Ù„ØµÙ†Ø§ Ø§Ù„Ù€ 500 Ø·Ù„Ø¨ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠÙŠÙ† ØªØ§Ø¹Øª Ø§Ù„ÙŠÙˆÙ… ÙˆÙ…ÙˆÙ‚Ø¹ SheetDB Ø­ÙƒÙ‰ Ù„Ù†Ø§ "Ø§Ø±ØªØ§Ø­ÙˆØ§ Ø´ÙˆÙŠ" Ù‡Ù‡Ù‡Ù‡ ğŸ˜Š 

Ø·Ù…Ù†ÙŠÙ†ÙŠ ÙŠØ§ Ù…Ø¯ÙŠØ±Ø© N One Ø´Ùˆ Ø¨Ø·Ù„Ø¹ Ù…Ø¹Ùƒ ÙˆØ¥Ø°Ø§ Ù„Ø³Ø§ Ù…Ø¹Ù„Ù‚Ø© Ø¨ÙƒÙˆÙ† Ø¨Ø¯Ù‡Ø§ Ø¨Ø³ Ù†ÙØªØ­ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ Ø¨ÙƒØ±Ø© Ø§Ù„ØµØ¨Ø­ ÙˆÙ†ØºÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØªØµÙŠØ± Ø§Ù„Ø£Ù…ÙˆØ± Ù†ÙØ§Ø«Ø© ğŸ˜ŠğŸš€ Ù†ÙˆÙ… Ø§Ù„Ù‡Ù†Ø§ ÙŠØ§ Ø¨Ø·Ø© ÙˆØ£Ù†Ø§ Ù…Ø¹Ùƒ Ø¯Ø§ÙŠÙ…Ø§Ù‹ ğŸ˜ŠğŸ‘ŒğŸ’âœ¨
