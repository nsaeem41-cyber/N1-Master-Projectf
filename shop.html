<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N One | Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ø§Ø³ÙŠØ© (Final Edition)</title>
    
    <script src="https://cdn.jsdelivr.net/gh/nsaeem41-cyber/N1-Master-Project@main/n-one-core.js"></script>

    <style>
        /* ================= ØªØµÙ…ÙŠÙ… Diamond Matrix (Navy & Gold) ================= */
        :root {
            --primary: #1a237e;      /* ÙƒØ­Ù„ÙŠ Ù…Ù„ÙƒÙŠ */
            --gold: #d4af37;         /* Ø°Ù‡Ø¨ÙŠ */
            --bg: #eceff1;           /* Ø®Ù„ÙÙŠØ© Ø±Ù…Ø§Ø¯ÙŠØ© ÙØ§ØªØ­Ø© Ø¬Ø¯Ø§Ù‹ */
            --text: #37474f;            
            --success: #2e7d32;      
            --danger: #c62828;
            --night: #311b92;        /* Ù„ÙˆÙ† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: var(--bg); margin: 0; padding: 0; 
            color: var(--text); user-select: none; 
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ù„ÙƒÙŠ */
        .navbar { 
            background: var(--primary); height: 70px; 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 0 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
            border-bottom: 4px solid var(--gold);
            position: sticky; top: 0; z-index: 1000; transition: 0.5s;
        }
        /* ÙˆØ¶Ø¹ Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù„ÙŠÙ„ÙŠ */
        .navbar.night-mode { background: linear-gradient(45deg, #000000, #311b92); border-bottom-color: #7c4dff; }

        .brand { font-size: 24px; font-weight: 900; color: white; letter-spacing: 1px; }
        .gold-text { color: var(--gold); }
        
        .btn-back { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 8px 15px; border-radius: 6px; cursor: pointer; text-decoration: none; font-size: 14px; transition: 0.3s; }
        .btn-back:hover { background: rgba(255,255,255,0.2); }

        .container { max-width: 1200px; margin: 30px auto; padding: 20px; }

        /* Ø¨Ù†Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù„ÙŠÙ„ÙŠ */
        .night-control-bar {
            background: white; padding: 15px; border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px;
            display: flex; justify-content: space-between; align-items: center;
            border-left: 5px solid var(--night);
        }
        
        /* Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ (Switch) */
        .switch { position: relative; display: inline-block; width: 50px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--night); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        .controls-panel { 
            background: white; padding: 20px; border-radius: 15px; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin-bottom: 30px;
            border-top: 4px solid var(--gold);
        }
        
        .controls-row { display: flex; justify-content: space-between; align-items: center; gap: 20px; margin-bottom: 15px; }
        
        /* Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ØµØ¯Ø± */
        .source-group { display: flex; gap: 10px; align-items: center; flex: 1; }
        .source-select { padding: 12px; border: 2px solid var(--primary); border-radius: 8px; font-weight: bold; color: var(--primary); outline: none; flex: 1; font-size: 15px; }
        
        .btn-icon { width: 40px; height: 40px; border-radius: 8px; border: none; cursor: pointer; font-size: 18px; transition: 0.2s; display: flex; align-items: center; justify-content: center; background: #eee; }
        .btn-icon:hover { transform: scale(1.1); }
        
        /* Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± */
        .search-box { flex: 2; position: relative; }
        .search-input { width: 100%; padding: 12px 40px 12px 15px; border: 1px solid #ccc; border-radius: 8px; outline: none; background: #fafafa; font-size: 14px; box-sizing: border-box; }
        .search-icon { position: absolute; right: 10px; top: 12px; color: #999; }

        .action-btns { display: flex; gap: 10px; }
        .btn-main { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; color: white; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); font-size: 14px; }
        
        .btn-save { background: var(--success); }
        .btn-save:hover { background: #1b5e20; transform: translateY(-2px); }
        .btn-dup { background: #546e7a; } /* Ø²Ø± Ø§Ù„Ù†Ø³Ø® */
        
        /* Ø§Ù„Ù…ØµÙÙˆÙØ© (Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬) */
        .matrix-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        .price-card {
            background: white; border-radius: 10px; padding: 10px 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #eee;
            display: flex; align-items: center; gap: 10px; transition: 0.2s;
            position: relative; overflow: hidden;
        }
        .price-card:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-color: var(--primary); }

        /* Ø§Ù„ÙƒØ±Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠ (Ø¹Ø±Ø¶ Ø®Ø§Øµ) */
        .price-card.gold-offer {
            background: linear-gradient(135deg, #fffde7, #fff9c4);
            border: 1px solid var(--gold);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }
        .price-card.gold-offer .area-name-input { color: #f57f17; }

        /* Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ±Ù†Ø¯ */
        .trend-icon { font-size: 10px; position: absolute; top: 2px; left: 5px; opacity: 0.7; }

        /* Ù…Ø¤Ø´Ø± Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
        .color-indicator { width: 5px; height: 100%; position: absolute; right: 0; top: 0; }
        .low-price { background: #66bb6a; } 
        .med-price { background: #ffa726; } 
        .high-price { background: #ef5350; } 

        .area-name-input { border: none; font-weight: bold; font-size: 14px; color: #333; flex: 1; outline: none; background: transparent; }
        .area-name-input:focus { border-bottom: 2px solid var(--primary); }

        /* Ø®Ø§Ù†Ø© Ø§Ù„Ø³Ø¹Ø± */
        .price-wrapper { position: relative; display: flex; align-items: center; }
        .price-val-input { width: 60px; padding: 5px; border: 1px solid #ddd; border-radius: 6px; text-align: center; font-weight: bold; color: var(--primary); outline: none; }
        .price-val-input:focus { border-color: var(--gold); background: #fff; }
        
        /* Ø´Ø§Ø±Ø© Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù„ÙŠÙ„ÙŠØ© */
        .night-badge { 
            font-size: 10px; background: var(--night); color: white; 
            padding: 2px 5px; border-radius: 4px; position: absolute; 
            top: -10px; right: 0; white-space: nowrap; pointer-events: none;
        }

        /* Ø£Ø¯ÙˆØ§Øª Ø§Ù„ÙƒØ±Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        .card-tools { display: flex; gap: 5px; align-items: center; }
        .mini-btn { background: none; border: none; cursor: pointer; font-size: 16px; transition: 0.2s; opacity: 0.6; }
        .mini-btn:hover { opacity: 1; transform: scale(1.2); }
        .btn-map { color: #1976d2; }
        .btn-offer { color: #ccc; } /* Ø±Ù…Ø§Ø¯ÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§ */
        .btn-offer.active { color: #ffb300; text-shadow: 0 0 5px #ffb300; opacity: 1; }

        /* ØªØ±ÙˆÙŠØ³Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ø®ÙÙŠØ© */
        .print-header { display: none; text-align: center; border-bottom: 3px solid var(--gold); padding-bottom: 10px; margin-bottom: 20px; }

        /* ================= ØªØµÙ…ÙŠÙ… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ================= */
        @media print {
            body { background: white; -webkit-print-color-adjust: exact; }
            .navbar, .controls-panel, .night-control-bar, .card-tools, .btn-main, .night-badge { display: none !important; }
            .container { margin: 0; padding: 0; max-width: 100%; }
            .print-header { display: block; }
            .matrix-container { display: block; column-count: 2; column-gap: 20px; }
            .price-card { break-inside: avoid; border: 1px solid #ccc; box-shadow: none; margin-bottom: 10px; padding: 5px 10px; }
            .area-name-input, .price-val-input { border: none; background: transparent; }
            .price-val-input { text-align: left; }
        }
    </style>
</head>
<body>

    <nav class="navbar" id="main-nav">
        <div class="brand">N <span class="gold-text">One</span> Smart Matrix</div>
        <a href="client.html" class="btn-back">â¬…ï¸ Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©</a>
    </nav>

    <div class="container">
        
        <div class="night-control-bar">
            <div style="display:flex; align-items:center; gap:10px;">
                <span style="font-size:24px;">ğŸŒ™</span>
                <div>
                    <div style="font-weight:bold; font-size:14px; color:#37474f;">Ø§Ù„Ø­Ø§Ø±Ø³ Ø§Ù„Ù„ÙŠÙ„ÙŠ (Ø§Ù„ØªØ³Ø¹ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ)</div>
                    <div style="font-size:11px; color:#777;">Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„: Ø²ÙŠØ§Ø¯Ø© 0.50 Ø¯.Ø£ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© 11:00 Ù…</div>
                </div>
            </div>
            <label class="switch">
                <input type="checkbox" id="night-toggle" onchange="toggleNightModeOverride()" checked>
                <span class="slider"></span>
            </label>
        </div>

        <div class="controls-panel">
            <div class="controls-row">
                <div class="source-group">
                    <label style="font-weight:bold; font-size:12px;">Ø§Ù„Ù…ØµØ¯Ø±:</label>
                    <select id="source-select" class="source-select" onchange="renderMatrix()">
                        </select>
                    <button class="btn-icon" onclick="addSource()" title="Ø¥Ø¶Ø§ÙØ© Ù…ØµØ¯Ø± Ø¬Ø¯ÙŠØ¯">â•</button>
                    <button class="btn-icon" onclick="duplicateSource()" title="Ù†Ø³Ø® Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Quick Duplicate)" style="background:#e3f2fd; color:#1565c0;">ğŸ“‘</button>
                    <button class="btn-icon" onclick="deleteSource()" title="Ø­Ø°Ù Ø§Ù„Ù…ØµØ¯Ø±" style="background:#ffebee; color:var(--danger);">ğŸ—‘ï¸</button>
                </div>

                <div class="search-box">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" id="search-input" class="search-input" placeholder="Ø¨Ø­Ø« Ø°ÙƒÙŠ Ø¹Ù† Ù…Ù†Ø·Ù‚Ø©..." oninput="renderMatrix()">
                </div>
            </div>

            <div class="controls-row" style="justify-content: flex-end; margin-bottom:0;">
                <div class="action-btns">
                    <button class="btn-main" style="background:#37474f;" onclick="addArea()">+ Ù…Ù†Ø·Ù‚Ø©</button>
                    <button class="btn-main" style="background:var(--primary);" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
                    <button class="btn-main btn-save" onclick="saveData()">ğŸ’¾ Ø­ÙØ¸ ÙˆØ§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</button>
                </div>
            </div>
        </div>

        <div class="print-header">
            <h1 style="color:#1a237e; margin:0;">N <span style="color:#d4af37">One</span> Delivery</h1>
            <p style="margin:5px 0; color:#555; font-size:14px;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© - <span id="print-source-name"></span></p>
        </div>

        <div id="matrix-grid" class="matrix-container">
            </div>

    </div>

    <script>
        // ========================================================
        // ÙƒÙˆØ¯ Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø§Ø³ÙŠØ© - v5.0 (Full Manual Control)
        // ========================================================
        
        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        const defaultData = {
            "Ø§Ù„Ø¬Ø¨ÙŠÙ‡Ø©": [
                { area: "Ø­ÙŠ Ø§Ù„Ø±ÙŠØ§Ù† / Ø§Ù„Ø²ÙˆØªÙ†ÙŠØ©", price: 1.50, isOffer: false, lastMod: Date.now() },
                { area: "Ø¶Ø§Ø­ÙŠØ© Ø§Ù„Ø±Ø´ÙŠØ¯", price: 2.00, isOffer: true, lastMod: Date.now() },
                { area: "ØªÙ„Ø§Ø¹ Ø§Ù„Ø¹Ù„ÙŠ / Ø³ÙˆÙ‚ Ø§Ù„Ø³Ù„Ø·Ø§Ù†", price: 2.50, isOffer: false, lastMod: Date.now() },
                { area: "Ø®Ù„Ø¯Ø§ / Ø£Ù… Ø§Ù„Ø³Ù…Ø§Ù‚", price: 3.00, isOffer: false, lastMod: Date.now() },
                { area: "Ø¯Ø§Ø¨ÙˆÙ‚ / Ø§Ù„Ø±Ø§Ø¨ÙŠØ©", price: 4.00, isOffer: false, lastMod: Date.now() },
                { area: "Ù…Ø±Ø¬ Ø§Ù„Ø­Ù…Ø§Ù…", price: 6.00, isOffer: false, lastMod: Date.now() }
            ]
        };

        // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        let pricingData = JSON.parse(localStorage.getItem('nOne_global_prices')) || defaultData;
        let isNightActive = false; // Ù‡Ù„ Ø§Ù„ØªØ³Ø¹ÙŠØ± Ø§Ù„Ù„ÙŠÙ„ÙŠ Ù…ÙØ¹Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹ØŸ

        window.onload = function() {
            // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø­Ø§Ù„Ø© Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù„ÙŠÙ„ÙŠ
            const savedToggle = localStorage.getItem('nOne_night_toggle');
            if (savedToggle !== null) {
                document.getElementById('night-toggle').checked = (savedToggle === 'true');
            }
            
            checkNightMode();
            populateSources();
            renderMatrix();
            
            // ÙØ­Øµ Ø§Ù„ÙˆÙ‚Øª ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
            setInterval(checkNightMode, 60000);
        };

        // 1. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø§Ø±Ø³ Ø§Ù„Ù„ÙŠÙ„ÙŠ (ÙŠØ¯ÙˆÙŠ + Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ)
        function checkNightMode() {
            const hour = new Date().getHours();
            // Ø§Ù„ÙˆÙ‚Øª: Ù…Ù† 11 Ù… (23) Ø¥Ù„Ù‰ 6 Øµ (6)
            const isNightTime = (hour >= 23 || hour < 6);
            // Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„ÙŠØ¯ÙˆÙŠ: Ù‡Ù„ Ø³Ù…Ø­ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ØªØ³Ø¹ÙŠØ± Ø§Ù„Ù„ÙŠÙ„ÙŠØŸ
            const isToggleOn = document.getElementById('night-toggle').checked;
            
            // Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: Ø§Ù„ÙˆÙ‚Øª Ù„ÙŠÙ„ + Ø§Ù„Ù…ÙØªØ§Ø­ Ø´ØºØ§Ù„
            const shouldBeNight = isNightTime && isToggleOn;

            if (shouldBeNight !== isNightActive) {
                isNightActive = shouldBeNight;
                renderMatrix(); // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
            }

            // ØªØ­Ø¯ÙŠØ« Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù‡ÙŠØ¯Ø± ÙÙ‚Ø·
            const nav = document.getElementById('main-nav');
            if (isNightActive) nav.classList.add('night-mode');
            else nav.classList.remove('night-mode');
        }

        function toggleNightModeOverride() {
            // Ø­ÙØ¸ ØªÙØ¶ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            const isChecked = document.getElementById('night-toggle').checked;
            localStorage.setItem('nOne_night_toggle', isChecked);
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙØ­Øµ Ø§Ù„ÙÙˆØ±ÙŠ
            checkNightMode();
        }

        // 2. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø¯Ø±
        function populateSources() {
            const select = document.getElementById('source-select');
            const currentVal = select.value;
            select.innerHTML = '';
            Object.keys(pricingData).forEach(source => {
                const option = document.createElement('option');
                option.value = source;
                option.innerText = source;
                select.appendChild(option);
            });
            if (currentVal && pricingData[currentVal]) select.value = currentVal;
        }

        function addSource() {
            const name = prompt("Ø§Ø³Ù… Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
            if (name && !pricingData[name]) {
                pricingData[name] = [];
                populateSources();
                document.getElementById('source-select').value = name;
                renderMatrix();
                saveData(true);
            }
        }

        function duplicateSource() {
            const current = document.getElementById('source-select').value;
            const newName = prompt(`Ù†Ø³Ø® Ù‚Ø§Ø¦Ù…Ø© (${current}) Ø¥Ù„Ù‰ Ù…Ø¯ÙŠÙ†Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø§Ø³Ù…:`);
            if (newName && !pricingData[newName]) {
                pricingData[newName] = JSON.parse(JSON.stringify(pricingData[current]));
                populateSources();
                document.getElementById('source-select').value = newName;
                renderMatrix();
                saveData(true);
            }
        }

        function deleteSource() {
            const current = document.getElementById('source-select').value;
            if (confirm(`Ø­Ø°Ù Ù‚Ø§Ø¦Ù…Ø© (${current}) Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ`)) {
                delete pricingData[current];
                if (Object.keys(pricingData).length === 0) pricingData["Default"] = [];
                populateSources();
                renderMatrix();
                saveData(true);
            }
        }

        // 3. Ø±Ø³Ù… Ø§Ù„Ù…ØµÙÙˆÙØ© (Smart Render)
        function renderMatrix() {
            const source = document.getElementById('source-select').value;
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const container = document.getElementById('matrix-grid');
            
            document.getElementById('print-source-name').innerText = source;
            container.innerHTML = '';

            const areas = pricingData[source] || [];

            areas.forEach((item, index) => {
                if (searchTerm && !item.area.toLowerCase().includes(searchTerm)) return;

                // Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)
                const basePrice = parseFloat(item.price);
                
                // Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶ (Ù…Ø¹ Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ Ù†Ø´Ø·Ø§Ù‹)
                let displayPrice = basePrice;
                let nightBadgeHtml = '';
                
                if (isNightActive) {
                    displayPrice += 0.50;
                    nightBadgeHtml = `<span class="night-badge">+0.50 Ù„ÙŠÙ„ÙŠ ğŸŒ™</span>`;
                }

                // Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„ØªØ±Ù†Ø¯
                let colorClass = 'med-price';
                if (basePrice < 3) colorClass = 'low-price';
                if (basePrice >= 5) colorClass = 'high-price';

                const offerClass = item.isOffer ? 'gold-offer' : '';
                const starClass = item.isOffer ? 'active' : '';

                let trendHtml = '';
                const oneDay = 24 * 60 * 60 * 1000;
                if (item.lastMod && (Date.now() - item.lastMod < oneDay)) {
                    trendHtml = '<span class="trend-icon">ğŸ“ˆ Ù…Ø­Ø¯Ø«</span>';
                }

                container.innerHTML += `
                    <div class="price-card ${offerClass}">
                        <div class="color-indicator ${colorClass}"></div>
                        ${trendHtml}
                        
                        <input type="text" class="area-name-input" value="${item.area}" onchange="updateItem('${source}', ${index}, 'area', this.value)">
                        
                        <div class="price-wrapper">
                            ${nightBadgeHtml}
                            <input type="number" class="price-val-input" value="${displayPrice.toFixed(2)}" step="0.25" onchange="updateItem('${source}', ${index}, 'price', this.value)">
                        </div>
                        
                        <div class="card-tools">
                            <span style="font-size:10px; color:#777;">Ø¯.Ø£</span>
                            
                            <button class="mini-btn btn-map" onclick="openMap('${item.area}', '${source}')" title="Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©">ğŸ“</button>
                            
                            <button class="mini-btn btn-offer ${starClass}" onclick="toggleOffer('${source}', ${index})" title="ØªÙ…ÙŠÙŠØ² ÙƒØ¹Ø±Ø¶ Ø®Ø§Øµ">â­</button>
                            
                            <button class="mini-btn" onclick="deleteItem('${source}', ${index})" style="color:#ff5252;">Ã—</button>
                        </div>
                    </div>
                `;
            });
        }

        // 4. Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ (Manual Edit)
        function updateItem(source, index, field, value) {
            // Ø¥Ø°Ø§ Ø¹Ø¯Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø³Ø¹Ø±ØŒ Ø¨Ø¯Ù†Ø§ Ù†Ø­ÙØ¸ "Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ"
            if (field === 'price') {
                let newVal = parseFloat(value);
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ Ø´ØºØ§Ù„ØŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø´Ø§ÙŠÙ (Ø§Ù„Ø³Ø¹Ø± + 0.50)
                // Ù„Ù…Ø§ ÙŠØ¹Ø¯Ù„ØŒ Ù‡Ùˆ Ø¨ÙŠØ¹Ø¯Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©ØŒ ÙÙ„Ø§Ø²Ù… Ù†Ø®ØµÙ… Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø¹Ø´Ø§Ù† Ù†Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø§Ø³
                if (isNightActive) {
                    newVal -= 0.50; 
                }
                // Ù…Ù†Ø¹ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø³Ø§Ù„Ø¨Ø©
                if (newVal < 0) newVal = 0;
                
                pricingData[source][index].price = newVal;
                pricingData[source][index].lastMod = Date.now();
            } else {
                pricingData[source][index][field] = value;
            }
            renderMatrix();
        }

        function addArea() {
            const source = document.getElementById('source-select').value;
            const name = prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:");
            if (name) {
                pricingData[source].push({ area: name, price: 0, isOffer: false, lastMod: Date.now() });
                renderMatrix();
            }
        }

        function deleteItem(source, index) {
            if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø·Ù‚Ø©ØŸ")) {
                pricingData[source].splice(index, 1);
                renderMatrix();
            }
        }

        function toggleOffer(source, index) {
            pricingData[source][index].isOffer = !pricingData[source][index].isOffer;
            renderMatrix();
        }

        function openMap(area, source) {
            const query = encodeURIComponent(`${area} ${source} Jordan`);
            window.open(`http://googleusercontent.com/maps.google.com/search?q=${query}`, '_blank');
        }

        // 5. Ø§Ù„Ø­ÙØ¸ (The Bridge)
        function saveData(silent = false) {
            localStorage.setItem('nOne_global_prices', JSON.stringify(pricingData));
            
            if (!silent) {
                const btn = document.querySelector('.btn-save');
                const originalHtml = btn.innerHTML;
                btn.innerHTML = "ØªÙ… Ø§Ù„ØªØ¹Ù…ÙŠÙ… ğŸ“¡";
                btn.style.background = "#004d40";
                setTimeout(() => {
                    btn.innerHTML = originalHtml;
                    btn.style.background = "var(--success)";
                    alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ØµÙÙˆÙØ©!\n- Ø§Ù„ØªØ³Ø¹ÙŠØ± Ø§Ù„Ù„ÙŠÙ„ÙŠ: " + (isNightActive ? "Ù†Ø´Ø· (+0.50)" : "Ù…ØªÙˆÙ‚Ù") + "\n- ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù„Ø¯Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø´Ø¢Øª.");
                }, 1000);
            }
        }

    </script>
</body>
</html>
