<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N One | Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„Ù…Ù„ÙƒÙŠØ© (Royal Access)</title>
    
    <script src="https://cdn.jsdelivr.net/gh/nsaeem41-cyber/N1-Master-Project@main/n-one-core.js"></script>

    <style>
        /* ================= ØªØµÙ…ÙŠÙ… Royal Shop (Navy & Gold) ================= */
        :root {
            --primary: #1a237e;      /* ÙƒØ­Ù„ÙŠ Ù…Ù„ÙƒÙŠ */
            --gold: #d4af37;         /* Ø°Ù‡Ø¨ÙŠ */
            --bg: #f5f5f5;           
            --panel: #ffffff;        
            --text: #333;            
            --success: #2e7d32;      
            --danger: #c62828;
            --night: #311b92;        /* Ù„ÙˆÙ† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: var(--bg); margin: 0; padding: 0; 
            color: var(--text); user-select: none; padding-bottom: 80px;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ù„ÙƒÙŠ */
        .navbar { 
            background: var(--primary); height: 70px; 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 0 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
            border-bottom: 4px solid var(--gold);
            position: sticky; top: 0; z-index: 1000;
        }
        .brand { font-size: 20px; font-weight: 900; color: white; letter-spacing: 1px; }
        .gold-text { color: var(--gold); }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ø¥Ù†Ø¬Ø§Ø² */
        .stats-panel {
            background: white; padding: 15px 20px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px;
        }
        .shop-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .shop-name { font-weight: bold; color: var(--primary); font-size: 16px; display: flex; align-items: center; gap: 5px; }
        .stars { color: #ffb300; font-size: 14px; }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… */
        .progress-container { width: 100%; background-color: #eee; border-radius: 10px; height: 10px; overflow: hidden; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, var(--primary), #5c6bc0); width: 0%; transition: 1s; }
        .progress-text { font-size: 11px; color: #777; margin-top: 5px; text-align: left; }

        .container { max-width: 500px; margin: 0 auto; padding: 0 20px; }

        /* ÙƒØ§Ø±Øª Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .order-card { 
            background: white; padding: 25px; border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            border-top: 5px solid var(--gold); 
            position: relative; overflow: hidden;
        }

        .input-group { margin-bottom: 15px; position: relative; }
        label { display: block; font-size: 12px; font-weight: bold; color: #555; margin-bottom: 5px; }
        
        input { 
            width: 100%; padding: 14px; border: 2px solid #eee; border-radius: 12px; 
            font-size: 16px; background: #fafafa; outline: none; box-sizing: border-box; 
            transition: 0.3s; 
        }
        input:focus { border-color: var(--primary); background: white; }

        /* Ø­Ù‚Ù„ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…ØºÙ„Ù‚ (The Safe) */
        .readonly-field { 
            background: #e8eaf6; color: var(--primary); font-weight: bold; 
            border-color: #c5cae9; pointer-events: none; 
        }
        .readonly-field.night-active { 
            background: #ede7f6; color: var(--night); border-color: #b39ddb; 
        }

        /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‚Ù…Ø± */
        .night-icon { 
            position: absolute; left: 15px; top: 38px; font-size: 18px; 
            display: none; animation: float 2s infinite; 
        }
        @keyframes float { 0% { transform: translateY(0); } 50% { transform: translateY(-3px); } 100% { transform: translateY(0); } }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn-send { 
            width: 100%; padding: 16px; background: var(--primary); color: white; 
            border: none; border-radius: 12px; font-size: 16px; font-weight: bold; 
            cursor: pointer; transition: 0.2s; box-shadow: 0 5px 15px rgba(26,35,126,0.2); 
            margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-send:active { transform: scale(0.98); }

        .btn-urgent { 
            width: 100%; padding: 14px; background: white; color: var(--danger); 
            border: 2px solid var(--danger); border-radius: 12px; font-size: 14px; font-weight: bold; 
            cursor: pointer; margin-top: 10px; transition: 0.2s; 
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-urgent:hover { background: #ffebee; }

        /* Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª */
        .history-section { margin-top: 30px; }
        .history-title { font-size: 14px; color: #777; margin-bottom: 10px; font-weight: bold; }
        .history-item { 
            background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.03); border-right: 4px solid #eee;
        }
        .history-item.confirmed { border-right-color: var(--success); }
        .history-item.pending { border-right-color: var(--gold); }

        /* Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .toast {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: #333; color: white; padding: 10px 20px; border-radius: 20px;
            font-size: 12px; display: none; z-index: 2000; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

    </style>
</head>
<body>

    <nav class="navbar">
        <div class="brand">N <span class="gold-text">One</span> Business</div>
        <div style="font-size:24px;">ğŸ¢</div>
    </nav>

    <div class="stats-panel">
        <div class="shop-info">
            <div class="shop-name">
                <span id="shop-display-name">N One Shop</span>
                <span class="stars">â˜…â˜…â˜…â˜….9</span> </div>
            <div style="font-size:12px; color:var(--success); font-weight:bold;">Ù†Ø´Ø· âœ…</div>
        </div>
        <div class="progress-container">
            <div class="progress-bar" id="daily-progress"></div>
        </div>
        <div class="progress-text">ğŸš€ Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ÙŠÙˆÙ…: <span id="daily-count">0</span> Ø·Ù„Ø¨Ø§Øª (Ø§Ø³ØªÙ…Ø± Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø°Ù‡Ø¨ÙŠ!)</div>
    </div>

    <div class="container">
        
        <div class="order-card">
            <h3 style="margin-top:0; color:var(--primary); text-align:center;">Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ğŸ“¦</h3>

            <div class="input-group">
                <label>ğŸ“ ÙˆØ¬Ù‡Ø© Ø§Ù„Ø·Ù„Ø¨ (Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†Ø·Ù‚Ø©)</label>
                <input type="text" id="destination" list="areas-list" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (Ù…Ø«Ù„Ø§Ù‹: ØªÙ„Ø§Ø¹...)" onchange="calculateFee()">
                <datalist id="areas-list">
                    </datalist>
            </div>

            <div class="input-group">
                <label>ğŸ’° Ù‚ÙŠÙ…Ø© Ø§Ù„ØªØ­ØµÙŠÙ„ (Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆØ±Ø¯Ø±)</label>
                <input type="number" id="order_val" placeholder="0.00">
            </div>

            <div class="input-group">
                <label>ğŸ›µ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ (Ù…Ø­Ø³ÙˆØ¨Ø© Ø¢Ù„ÙŠØ§Ù‹)</label>
                <input type="text" id="delivery_fee" class="readonly-field" placeholder="0.00" readonly>
                <span class="night-icon" id="night-moon" title="ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ³Ø¹ÙŠØ± Ø§Ù„Ù„ÙŠÙ„ÙŠ">ğŸŒ™</span>
            </div>

            <button class="btn-send" onclick="sendOrder(false)">
                <span>Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ÙÙˆØ±Ø§Ù‹</span> ğŸš€
            </button>
            
            <button class="btn-urgent" onclick="sendOrder(true)">
                <span>âš¡ Ø·Ù„Ø¨ Ù…Ø³ØªØ¹Ø¬Ù„ (VIP)</span>
            </button>
        </div>

        <div class="history-section">
            <div class="history-title">ğŸ“ Ø¢Ø®Ø± Ø·Ù„Ø¨Ø§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…</div>
            <div id="history-list">
                </div>
        </div>

    </div>

    <div id="toast" class="toast">ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­ âœ…</div>

    <script>
        // ========================================================
        // ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø§Ù„Ù…Ù„ÙƒÙŠØ© - v6.0 (Ø§Ù„Ù…Ø±Ø¨ÙˆØ· Ø¨Ø§Ù„Ù…ØµÙÙˆÙØ©)
        // ========================================================

        // Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙŠØ±ÙØ± (Ø§Ù„Ù†ÙˆØ§Ø©)
        const API_URL = "https://script.google.com/macros/s/AKfycbybaX1dgu-rVIkUAz2w6H2NdYIuv3zKkmPbHON8NTRclD3H6cVgyW5SAzFfAPNcMt6g/exec";
        
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        let pricingMatrix = {}; // Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø©
        let shopData = JSON.parse(localStorage.getItem('nOne_shop_data')) || { 
            ordersToday: 0, 
            history: [] 
        };
        let currentUser = JSON.parse(localStorage.getItem('currentUser'));

        window.onload = function() {
            if (!currentUser) {
                // Ù…Ø­Ø§ÙƒØ§Ø© Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø¬Ù„Ø³Ø© (Ù„Ù„ØªØ¬Ø±Ø¨Ø©)
                currentUser = { name: "Ù…Ù†Ø´Ø£Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©", user: "demo_shop" };
            }
            document.getElementById('shop-display-name').innerText = currentUser.name;
            
            // 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø§Ø³ÙŠØ© (The Bridge)
            loadPricingMatrix();
            
            // 2. ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²
            updateProgressBar();
            renderHistory();
        };

        // Ø¯Ø§Ù„Ø© Ø³Ø­Ø¨ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù…Ù† "Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ" Ø§Ù„Ø°ÙŠ Ø£Ù†Ø´Ø£Ù†Ø§Ù‡ ÙÙŠ prices.html
        function loadPricingMatrix() {
            const rawData = localStorage.getItem('nOne_global_prices');
            if (rawData) {
                const allData = JSON.parse(rawData);
                const datalist = document.getElementById('areas-list');
                
                // Ø¯Ù…Ø¬ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø¯Ø± (Ø§Ù„Ø¬Ø¨ÙŠÙ‡Ø©ØŒ Ø¹Ù…Ø§Ù†ØŒ Ø¥Ù„Ø®) ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ù‡Ù„
                // ÙÙŠ Ù†Ø¸Ø§Ù… Ù…ØªÙ‚Ø¯Ù…ØŒ Ù†Ø±Ø¨Ø· ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù…ØµØ¯Ø± Ù…Ø­Ø¯Ø¯ØŒ Ù‡Ù†Ø§ Ø³Ù†Ø¬Ø¹Ù„ Ø§Ù„Ø¨Ø­Ø« Ù…ÙØªÙˆØ­Ø§Ù‹ Ù„Ù„Ø³Ù‡ÙˆÙ„Ø©
                Object.keys(allData).forEach(source => {
                    allData[source].forEach(item => {
                        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù„Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
                        pricingMatrix[item.area] = parseFloat(item.price);
                        
                        // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
                        const option = document.createElement('option');
                        option.value = item.area;
                        datalist.appendChild(option);
                    });
                });
                console.log("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø§Ø³ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ ğŸ’");
            }
        }

        // Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„ØªØ³Ø¹ÙŠØ± Ø§Ù„Ø°ÙƒÙŠ + Ø§Ù„Ø­Ø§Ø±Ø³ Ø§Ù„Ù„ÙŠÙ„ÙŠ
        function calculateFee() {
            const areaName = document.getElementById('destination').value;
            const feeInput = document.getElementById('delivery_fee');
            const moonIcon = document.getElementById('night-moon');
            
            if (pricingMatrix[areaName]) {
                let basePrice = pricingMatrix[areaName];
                
                // ÙØ­Øµ Ø§Ù„Ø­Ø§Ø±Ø³ Ø§Ù„Ù„ÙŠÙ„ÙŠ
                const hour = new Date().getHours();
                const isNightTime = (hour >= 23 || hour < 6);
                const isNightToggleOn = localStorage.getItem('nOne_night_toggle') === 'true'; // Ù†Ù‚Ø±Ø£ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                
                if (isNightTime && isNightToggleOn) {
                    basePrice += 0.50;
                    feeInput.classList.add('night-active');
                    moonIcon.style.display = 'block';
                } else {
                    feeInput.classList.remove('night-active');
                    moonIcon.style.display = 'none';
                }

                feeInput.value = basePrice.toFixed(2);
                
                // ÙˆÙ…ÙŠØ¶ Ø¨Ø³ÙŠØ· Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø³Ø¹Ø±
                feeInput.style.backgroundColor = "#fff9c4"; // Ø£ØµÙØ± ÙØ§ØªØ­
                setTimeout(() => {
                    feeInput.style.backgroundColor = feeInput.classList.contains('night-active') ? '#ede7f6' : '#e8eaf6';
                }, 500);

            } else {
                feeInput.value = "";
                moonIcon.style.display = 'none';
            }
        }

        async function sendOrder(isUrgent) {
            const dest = document.getElementById('destination').value;
            const val = document.getElementById('order_val').value;
            const fee = document.getElementById('delivery_fee').value;

            if (!dest || !val || !fee) {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†Ø·Ù‚Ø© ØµØ­ÙŠØ­Ø© ÙˆØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© â˜ºï¸");
                return;
            }

            const btn = document.querySelector('.btn-send');
            const originalText = btn.innerHTML;
            btn.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ğŸ“¡...";
            btn.disabled = true;

            // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø·Ù„Ø¨
            const newOrder = {
                id: "ORD_" + Date.now(),
                type: "order",
                client_user: currentUser.user,
                cl_name: currentUser.name,
                
                // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
                pickup: dest, // Ø§Ù„ÙˆØ¬Ù‡Ø©
                val: val,
                fee: fee,
                
                date: new Date().toISOString(),
                is_emergency: isUrgent,
                status: isUrgent ? "emergency" : "new"
            };

            try {
                // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø³ÙŠØ±ÙØ±
                await fetch(API_URL, {
                    method: 'POST', mode: 'no-cors',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ action: 'add', data: newOrder })
                });

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                shopData.ordersToday++;
                shopData.history.unshift({ dest: dest, val: val, time: new Date().toLocaleTimeString() });
                localStorage.setItem('nOne_shop_data', JSON.stringify(shopData));
                
                showToast();
                updateProgressBar();
                renderHistory();
                
                // ØªÙ†Ø¸ÙŠÙ
                document.getElementById('destination').value = '';
                document.getElementById('order_val').value = '';
                document.getElementById('delivery_fee').value = '';
                document.getElementById('night-moon').style.display = 'none';

            } catch (e) {
                alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± ğŸ˜”");
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        function updateProgressBar() {
            const count = shopData.ordersToday;
            const max = 10; // Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ
            const percent = Math.min((count / max) * 100, 100);
            
            document.getElementById('daily-progress').style.width = percent + "%";
            document.getElementById('daily-count').innerText = count;
            
            if (count >= max) {
                document.getElementById('daily-progress').style.background = "linear-gradient(90deg, #fbc02d, #fdd835)"; // ØªØ­ÙˆÙ„ Ù„Ø°Ù‡Ø¨ÙŠ
            }
        }

        function renderHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = '';
            // Ø¹Ø±Ø¶ Ø¢Ø®Ø± 3 Ø·Ù„Ø¨Ø§Øª
            shopData.history.slice(0, 3).forEach(item => {
                list.innerHTML += `
                    <div class="history-item pending">
                        <div>
                            <div style="font-weight:bold; color:var(--primary);">${item.dest}</div>
                            <div style="font-size:11px; color:#aaa;">${item.time}</div>
                        </div>
                        <div style="font-weight:bold; color:var(--success);">${item.val} Ø¯.Ø£</div>
                    </div>
                `;
            });
        }

        function showToast() {
            const toast = document.getElementById('toast');
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 3000);
        }

    </script>
</body>
</html>
